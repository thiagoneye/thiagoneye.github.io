const getA11ySettings=()=>{const e=localStorage.getItem("a11ySettings");return e?JSON.parse(e):{disableBlur:!1,disableImages:!1,fontSize:"default",underlineLinks:!1,zenMode:!1}},saveA11ySettings=e=>{localStorage.setItem("a11ySettings",JSON.stringify(e))},applyImageState=(e,t,n)=>{if(!e)return;n?e.style.display="none":(e.style.display="",t&&!e.getAttribute("src")&&e.setAttribute("src",t))},applyFontSize=e=>{const t=localStorage.getItem("a11ySettings")===null;!t&&e!=="default"&&(document.documentElement.style.fontSize=e)},applyUnderlineLinks=e=>{let t=document.getElementById("a11y-underline-links");e?t||(t=document.createElement("style"),t.id="a11y-underline-links",t.textContent="a { text-decoration: underline !important; }",document.head.appendChild(t)):t&&t.remove()},applyZenMode=e=>{const t=document.querySelector("body"),n=t&&t.classList.contains("zen-mode-enable");if(e!==n){const e=document.querySelector('[id$="zen-mode"]');e&&typeof _toggleZenMode=="function"&&_toggleZenMode(e,{scrollToHeader:!1})}},applyA11ySettings=()=>{const e=getA11ySettings();document.querySelectorAll("script[data-target-id]").forEach(t=>{const n=t.getAttribute("data-target-id"),s=Number(t.getAttribute("data-scroll-divisor")||300),o=t.getAttribute("data-image-id"),i=t.getAttribute("data-image-url"),a=n==="menu-blur";setBackgroundBlur(n,s,e.disableBlur,a),applyImageState(document.getElementById(o),i,e.disableImages)}),applyFontSize(e.fontSize),applyUnderlineLinks(e.underlineLinks),applyZenMode(e.zenMode)},updateA11ySetting=(e,t)=>{const n=getA11ySettings();n[e]=t,saveA11ySettings(n),applyA11ySettings()},toggleA11yPanel=(e="")=>{const s=document.getElementById(`${e}a11y-panel`),n=document.getElementById(`${e}a11y-overlay`),t=document.getElementById(`${e}a11y-toggle`);if(!s||!n||!t)return;n.classList.contains("hidden")?(n.classList.remove("hidden"),s.classList.remove("hidden"),t.setAttribute("aria-pressed","true"),t.setAttribute("aria-expanded","true")):(n.classList.add("hidden"),s.classList.add("hidden"),t.setAttribute("aria-pressed","false"),t.setAttribute("aria-expanded","false"))},initA11yPanel=(e="")=>{const t=getA11ySettings(),n=document.getElementById(`${e}disable-blur`),s=document.getElementById(`${e}disable-images`),o=document.getElementById(`${e}underline-links`),i=document.getElementById(`${e}zen-mode`),a=document.getElementById(`${e}font-size-select`),c=document.getElementById(`${e}a11y-toggle`),l=document.getElementById(`${e}a11y-close`),r=document.getElementById(`${e}a11y-overlay`);if(!n||!s||!o||!i||!a||!c||!l||!r){console.warn(`One or more a11y elements not found for prefix: ${e}`);return}n.checked=t.disableBlur,s.checked=t.disableImages,o.checked=t.underlineLinks,i.checked=t.zenMode,a.value=t.fontSize,n.addEventListener("change",e=>updateA11ySetting("disableBlur",e.target.checked)),s.addEventListener("change",e=>updateA11ySetting("disableImages",e.target.checked)),o.addEventListener("change",e=>updateA11ySetting("underlineLinks",e.target.checked)),i.addEventListener("change",e=>{updateA11ySetting("zenMode",e.target.checked)}),a.addEventListener("change",e=>{if(e.target.value==="default"){const e=getA11ySettings();delete e.fontSize,saveA11ySettings(e),document.documentElement.style.fontSize=""}else updateA11ySetting("fontSize",e.target.value)}),c.addEventListener("click",()=>toggleA11yPanel(e)),l.addEventListener("click",()=>toggleA11yPanel(e)),r.addEventListener("click",t=>{t.target===r&&toggleA11yPanel(e)}),document.querySelectorAll(`.ios-toggle${e?`[id^="${e}"]`:""}`).forEach(e=>{const n=e.querySelector('input[type="checkbox"]');if(!n)return;const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",()=>{const e=t.querySelector('input[type="checkbox"]');e&&(e.checked=!e.checked,e.dispatchEvent(new Event("change",{bubbles:!0})))})})};document.querySelectorAll("script[data-target-id]").forEach(e=>{const t=e.getAttribute("data-image-id"),n=e.getAttribute("data-image-url"),s=getA11ySettings();applyImageState(document.getElementById(t),n,s.disableImages)}),document.addEventListener("DOMContentLoaded",()=>{applyA11ySettings();const e=document.querySelectorAll('[id$="a11y-panel"]');e.forEach(e=>{const t=e.id.replace("a11y-panel","");initA11yPanel(t)})})